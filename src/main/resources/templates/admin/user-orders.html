<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Đơn hàng của khách</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">
      Đơn hàng của <span th:text="${viewUser.username}">user</span>
    </h2>
    <a th:href="@{/admin/orders}" class="btn btn-outline-secondary mb-3">← Quay lại danh sách</a>

    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Ngày tạo</th>
          <th>Tổng tiền</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="o : ${orders}">
          <td th:text="${o.id}">1</td>
          <td th:text="${#dates.format(o.createdAt,'dd/MM/yyyy HH:mm')}">16/07/2025 20:30</td>
          <td th:text="${#numbers.formatDecimal(o.total,0,'COMMA',2,'POINT')}">10,000,000</td>
          <td>
            <span th:text="${o.status}"
                  th:classappend="
                    ${o.status}=='PENDING'   ? 'badge bg-warning text-dark' :
                    ${o.status}=='CONFIRMED' ? 'badge bg-info' :
                    ${o.status}=='SHIPPED'   ? 'badge bg-primary' :
                    ${o.status}=='DELIVERED'? 'badge bg-success' :
                                              'badge bg-secondary'">
              PENDING
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <!-- Xác nhận -->
              <form th:action="@{/admin/orders/{id}/confirm(id=${o.id})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-sm btn-outline-success"
                        th:if="${o.status} == T(com.bigkhoa.model.OrderStatus).PENDING">
                  Xác nhận
                </button>
              </form>
              <!-- Ship -->
              <form th:action="@{/admin/orders/{id}/ship(id=${o.id})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-sm btn-outline-primary"
                        th:if="${o.status} == T(com.bigkhoa.model.OrderStatus).CONFIRMED}">
                  Ship
                </button>
              </form>
              <!-- Deliver -->
              <form th:action="@{/admin/orders/{id}/deliver(id=${o.id})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-sm btn-outline-dark"
                        th:if="${o.status} == T(com.bigkhoa.model.OrderStatus).SHIPPED}">
                  Deliver
                </button>
              </form>
            </div>
            <!-- Dropdown status -->
            <form th:action="@{/admin/orders/{id}/status(id=${o.id})}" method="post" class="mt-2">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <select name="status" class="form-select form-select-sm"
                      onchange="this.form.submit()">
                <option th:each="s : ${allStatuses}"
                        th:value="${s}" th:text="${s}"
                        th:selected="${s} == ${o.status}">PENDING</option>
              </select>
            </form>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <footer th:fragment="admin-footer">
  <div class="container text-center py-4 border-top mt-5">
    <p class="mb-1">&copy; <span th:text="${T(java.time.Year).now()}">2025</span> ADMIN MANAGER - All rights reserved.</p>
    <p class="text-muted small">Hệ thống quản trị dành cho quản lý sản phẩm, đơn hàng và người dùng.</p>
  </div>

  <!-- Optional scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Admin-only scripts here if needed -->
</footer>
</body>
</html>
