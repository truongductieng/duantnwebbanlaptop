<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Xác nhận đơn hàng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background:#f5f6fa; margin:0; font-family: Arial, Helvetica, sans-serif; color:#222; }
    .wrap { max-width:720px; margin:0 auto; background:#ffffff; }
    .header { background:#5865f2; color:#fff; padding:18px 24px; }
    .header h1 { margin:0; font-size:20px; }
    .section { padding:20px 24px; }
    .muted { color:#666; font-size:13px; }
    .grid { display:flex; flex-wrap:wrap; gap:16px; }
    .card { flex:1; min-width:260px; background:#fafafa; border:1px solid #eee; border-radius:12px; padding:14px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:10px 8px; border-bottom:1px solid #eee; text-align:left; font-size:14px; vertical-align:top; }
    th { background:#f7f8ff; font-weight:600; }
    tfoot td { border-top:2px solid #e6e7ef; border-bottom:0; }
    .right { text-align:right; }
    .btn { display:inline-block; padding:12px 18px; border-radius:10px; text-decoration:none; background:#5865f2; color:#fff; }
    .totals td { font-weight:600; }
    .note { font-size:12px; color:#666; margin-top:8px; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1>✅ Xác nhận đơn hàng #<span th:text="${order.id}">0</span> – Laptop Shop</h1>
  </div>

  <div class="section">
    <p>Chào <b th:text="${order.recipientName != null ? order.recipientName : (order.customer != null ? order.customer.fullName : 'bạn')}">bạn</b>,</p>
    <p>Đơn hàng của bạn đã được tạo lúc
      <b th:text="${orderDate}">dd/MM/yyyy HH:mm</b>.
      Dưới đây là thông tin chi tiết:</p>

    <div class="grid">
      <div class="card">
        <div style="font-weight:600;margin-bottom:6px;">Thông tin nhận hàng</div>
        <div><b>Người nhận:</b> <span th:text="${order.recipientName}">Tên</span></div>
        <div><b>Điện thoại:</b> <span th:text="${order.recipientPhone}">SĐT</span></div>
        <div><b>Địa chỉ:</b> <span th:text="${order.recipientAddress}">Địa chỉ</span></div>
        <div class="muted" style="margin-top:6px;">Mã đơn: <span th:text="${order.id}">0</span></div>
      </div>

      <div class="card">
        <div style="font-weight:600;margin-bottom:6px;">Thanh toán</div>
        <div><b>Phương thức:</b> <span th:text="${order.paymentMethod}">COD</span></div>
        <div><b>Trạng thái:</b> <span th:text="${order.status}">PENDING</span></div>
        <div th:if="${order.discountCode != null}">
          <b>Mã giảm:</b> <span th:text="${order.discountCode}">SALE</span> (<span th:text="${order.discountPercent}">0</span>%)
        </div>
      </div>
    </div>

    <table>
      <thead>
      <tr>
        <th>Sản phẩm</th>
        <th class="right">Đơn giá</th>
        <th class="right">SL</th>
        <th class="right">Thành tiền</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${items}">
        <td>
          <div style="font-weight:600" th:text="${item.product.name}">Laptop</div>
          <div class="muted">
            Hãng: <span th:text="${item.product.brand}">Brand</span>
          </div>
        </td>
        <td class="right" th:text="${fmt.v(item.unitPrice)}">₫0</td>
        <td class="right" th:text="${item.quantity}">1</td>
        <td class="right"
            th:text="${fmt.v(item.unitPrice.multiply(T(java.math.BigDecimal).valueOf(item.quantity)))}">₫0</td>
      </tr>
      </tbody>
      <tfoot>
      <tr>
        <td colspan="3" class="right">Tạm tính</td>
        <td class="right" th:text="${fmt.v(order.totalBeforeDiscount)}">₫0</td>
      </tr>
      <tr th:if="${order.discountAmount != null and order.discountAmount > 0}">
        <td colspan="3" class="right">Giảm giá</td>
        <td class="right" th:text="${'- ' + fmt.v(order.discountAmount)}">- ₫0</td>
      </tr>
      <tr class="totals">
        <td colspan="3" class="right">Tổng thanh toán</td>
        <td class="right" th:text="${fmt.v(order.total)}">₫0</td>
      </tr>
      </tfoot>
    </table>

    <p style="margin-top:18px;">
      <a class="btn" th:href="${orderLink}">Xem chi tiết đơn hàng</a>
    </p>
    <p class="note">Nếu có thắc mắc, reply email này để được hỗ trợ.</p>
  </div>

  <div class="section muted" style="border-top:1px solid #eee;">
    Laptop Shop – Cảm ơn bạn đã mua sắm ❤️
  </div>
</div>
</body>
</html>
