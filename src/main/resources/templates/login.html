<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>Đăng nhập – Laptop Shop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
      /* =====================================================
         THEME (vừa phải) — gọn, dễ bảo trì
         - 3 preset màu + Dark mode
         - Giữ layout gốc, tinh chỉnh vừa đủ
         ===================================================== */
      :root {
        --primary: #5865f2;   /* Indigo */
        --primary-2: #4a56d6; /* Indigo dark */
        --bg-1: #eef1ff;      /* soft bg */
        --card-bg: #ffffff;
        --text: #111827;      /* gray-900 */
        --text-soft: #4b5563; /* gray-600 */
        --border: #e5e7eb;    /* gray-200 */
        --danger: #dc3545;
        --success: #16a34a;
        --warning: #f59e0b;
        --radius: 16px;
        --shadow: 0 12px 30px rgba(0,0,0,.08);
        --focus: 0 0 0 4px rgba(88,101,242,.18);
      }

      /* Dark mode */
      html[data-theme="dark"] {
        --bg-1: #0f172a;      /* slate-900 */
        --card-bg: #121826;   /* slate-950-ish */
        --text: #e5e7eb;
        --text-soft: #9ca3af;
        --border: #1f2937;
        --shadow: 0 12px 30px rgba(0,0,0,.5);
        --focus: 0 0 0 4px rgba(88,101,242,.25);
      }

      /* Alternate palettes via data-preset */
      html[data-preset="teal"] {
        --primary: #0ea5a4; --primary-2: #0a7f7e;
      }
      html[data-preset="rose"] {
        --primary: #e11d48; --primary-2: #be123c;
      }
      html[data-preset="indigo"] {
        --primary: #5865f2; --primary-2: #4a56d6;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background:
          radial-gradient(600px 400px at 20% 10%, rgba(88,101,242,.08), transparent 60%),
          linear-gradient(180deg, var(--bg-1), transparent 40%),
          linear-gradient(135deg, #ffffff10, #00000008);
        min-height: 100vh;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        color: var(--text);
        padding: 16px;
      }

      .wrap { width: 100%; max-width: 440px; }

      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 20px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .card-header {
        background: linear-gradient(180deg, var(--primary), var(--primary-2));
        color: #fff;
        text-align: center;
        padding: 22px 16px;
      }
      .title { font-size: 26px; font-weight: 800; margin: 0; }
      .subtitle { opacity: .95; margin-top: 4px; font-weight: 500; }

      .card-body { padding: 18px; }

      .form-label { font-weight: 700; color: var(--text-soft); }
      .form-control {
        border-radius: var(--radius);
        border: 2px solid #e6e8f0;
        padding: 12px 14px;
        background: #fff;
        transition: border-color .2s, box-shadow .2s, transform .1s;
      }
      html[data-theme="dark"] .form-control { background: #0b1220; border-color: #1f2937; color: var(--text); }
      .form-control::placeholder { color: #9aa1ad; }
      .form-control:focus { border-color: var(--primary); box-shadow: var(--focus); transform: translateY(-1px); }

      .btn { border-radius: var(--radius); font-weight: 800; padding: 12px 20px; position: relative; }
      .btn-primary {
        background: linear-gradient(180deg, var(--primary), var(--primary-2));
        border: none; color: #fff; width: 100%;
        box-shadow: 0 8px 18px rgba(0,0,0,.12);
        transition: transform .1s ease, box-shadow .2s ease;
      }
      .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.16); }
      .btn-primary:active { transform: translateY(0); }

      .btn-google { width: 100%; border-color: var(--danger); color: var(--danger); font-weight: 800; }
      .btn-google:hover { background: var(--danger); color: #fff; }

      .position-relative .toggle {
        position: absolute; right: 12px; top: 70%; transform: translateY(-50%);
        border: 0; background: transparent; color: #6b7280; cursor: pointer; padding: 6px; line-height: 1;
      }
      html[data-theme="dark"] .position-relative .toggle { color: #9ca3af; }

      .alert { border-radius: var(--radius); border: 1px solid var(--border); }
      .alert-warning { border-left: 4px solid var(--warning); }
      .alert-success { border-left: 4px solid var(--success); }

      /* Theme controls (nhẹ nhàng) */
      .themer-mini {
        display: flex; align-items: center; gap: 8px;
        justify-content: center; margin: 10px auto 14px;
      }
      .chip { border: 1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-size: 13px; cursor: pointer; user-select: none; }
      .chip[data-active="true"] { border-color: var(--primary); color: var(--primary); font-weight: 700; }
      .switch { display: inline-flex; align-items: center; gap: 6px; font-size: 13px; }

      @media (max-width: 480px) {
        .card { border-radius: 16px; }
        .title { font-size: 22px; }
      }

      @media (prefers-color-scheme: dark) {
        html[data-theme="auto"] { color-scheme: dark; }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <div class="card-header">
          <h1 class="title">Laptop Shop</h1>
          <div class="subtitle">Đăng nhập</div>
        </div>

        <div class="card-body">
          <!-- Theme mini controls -->
          <div class="themer-mini">
            <span class="chip" data-preset="indigo" data-active="true">Indigo</span>
            <span class="chip" data-preset="teal">Teal</span>
            <span class="chip" data-preset="rose">Rose</span>
            <label class="switch ms-1">
              <input id="darkToggle" class="form-check-input" type="checkbox" />
              <span>Dark</span>
            </label>
          </div>

          <div th:if="${param.error}" class="alert alert-warning mb-3">
            <i class="fa-solid fa-triangle-exclamation me-1"></i> Sai tên đăng nhập hoặc mật khẩu.
          </div>
          <div th:if="${param.logout}" class="alert alert-success mb-3">
            <i class="fa-solid fa-circle-check me-1"></i> Đã đăng xuất.
          </div>

          <form th:action="@{/login}" method="post" id="loginForm" novalidate>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <div class="mb-3">
              <label for="username" class="form-label">Tên đăng nhập</label>
              <input id="username" name="username" class="form-control" required autofocus inputmode="email" autocomplete="username" placeholder="vd: user@example.com" />
            </div>

            <div class="mb-2 position-relative">
              <label for="password" class="form-label">Mật khẩu</label>
              <input id="password" type="password" name="password" class="form-control" required autocomplete="current-password" placeholder="••••••••" />
              <button type="button" class="toggle" id="togglePassword" aria-label="Hiện/Ẩn mật khẩu">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>

            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="rememberMe" name="remember-me" />
                <label class="form-check-label" for="rememberMe">Nhớ đăng nhập</label>
              </div>
              <a class="small" th:href="@{/forgot-password}">Quên mật khẩu?</a>
            </div>

            <button id="submitBtn" type="submit" class="btn btn-primary">
              <span class="btn-text">Đăng nhập</span>
              <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
            </button>

            <div class="mt-2">
              <a href="/oauth2/authorization/google" class="btn btn-outline-danger btn-google">
                <i class="fab fa-google me-2"></i>Đăng nhập với Google
              </a>
            </div>
          </form>

          <hr class="my-4" />
          <p class="text-center helper mb-0">
            Chưa có tài khoản? <a th:href="@{/register}">Đăng ký</a>
          </p>
        </div>
      </div>
    </div>

    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script>
      // Toggle password
      const toggle = document.getElementById('togglePassword');
      const pwd = document.getElementById('password');
      toggle.addEventListener('click', () => {
        const isHidden = pwd.type === 'password';
        pwd.type = isHidden ? 'text' : 'password';
        const icon = toggle.querySelector('i');
        icon.classList.toggle('fa-eye', !isHidden);
        icon.classList.toggle('fa-eye-slash', isHidden);
        toggle.setAttribute('aria-pressed', isHidden ? 'true' : 'false');
        pwd.focus();
      });

      // Prevent double submit + spinner
      const form = document.getElementById('loginForm');
      const submitBtn = document.getElementById('submitBtn');
      form.addEventListener('submit', () => {
        submitBtn.disabled = true;
        submitBtn.querySelector('.spinner-border').classList.remove('d-none');
      });

      // Enter focus
      document.getElementById('username').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') { e.preventDefault(); document.getElementById('password').focus(); }
      });

      // Mini themer (3 preset + dark)
      const chips = document.querySelectorAll('.chip');
      const darkToggle = document.getElementById('darkToggle');
      const html = document.documentElement;
      const LS = 'loginModerateTheme:v1';

      function apply(preset = 'indigo', dark = false) {
        chips.forEach(c => c.dataset.active = (c.dataset.preset === preset));
        html.setAttribute('data-preset', preset);
        html.setAttribute('data-theme', dark ? 'dark' : 'light');
        localStorage.setItem(LS, JSON.stringify({ preset, dark }));
      }

      // Load saved
      try {
        const saved = JSON.parse(localStorage.getItem(LS) || '{}');
        if (saved.preset) apply(saved.preset, !!saved.dark);
        darkToggle.checked = !!saved.dark;
        chips.forEach(c => c.dataset.active = (c.dataset.preset === (saved.preset || 'indigo')));
      } catch {}

      chips.forEach(c => c.addEventListener('click', () => apply(c.dataset.preset, darkToggle.checked)));
      darkToggle.addEventListener('change', (e) => apply((document.querySelector('.chip[data-active="true"]').dataset.preset || 'indigo'), e.target.checked));
    </script>
  </body>
</html>
