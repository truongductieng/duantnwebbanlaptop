<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đăng nhập – Laptop Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <!-- Lottie -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <style>
    :root{
      --brand:#5865f2;
      --brand-2:#764ba2;
      --bg-1:#667eea;
      --danger:#db4437;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:flex;align-items:center;justify-content:center;
      background: radial-gradient(1200px 600px at 15% 10%, rgba(255,255,255,.12), transparent 60%),
                  linear-gradient(135deg, var(--bg-1) 0%, var(--brand-2) 100%);
      min-height:100vh;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    .card{
      width:100%;max-width:430px;background:#fff;border:0;border-radius:16px;overflow:hidden;
      box-shadow:0 20px 45px rgba(0,0,0,.25);
    }
    .card-header{
      background: linear-gradient(90deg, var(--brand), #7a88ff);
      color:#fff;text-align:center;padding:18px 16px;
    }
    .title{font-size:28px;font-weight:800;margin:0}
    .subtitle{opacity:.95;margin-top:2px;font-weight:500}
    .card-body{padding:20px 20px 16px}
    .form-label{font-weight:600}
    .form-control{
      border-radius:12px;border:1px solid #e6e6ef;padding:10px 14px;transition:.15s ease;
    }
    .form-control:focus{
      border-color: var(--brand);
      box-shadow:0 0 0 .2rem rgba(88,101,242,.2);
    }
    .btn{
      border-radius:12px;font-weight:700
    }
    .btn-primary{
      background:var(--brand);border-color:var(--brand);
    }
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-primary:disabled{opacity:.8}
    .btn-google{
      border-color:var(--danger);color:var(--danger);width:100%;
    }
    .btn-google:hover{background:var(--danger);color:#fff}
    .helper a{text-decoration:none}
    .helper a:hover{text-decoration:underline}
    .lottie-wrap{display:flex;justify-content:center;margin:10px 0 18px}
    .position-relative .toggle{
      position:absolute;right:12px;top:71%;transform:translateY(-50%);
      border:0;background:transparent;color:#6c757d;cursor:pointer;padding:6px;line-height:1
    }
    .position-relative .toggle:hover{color:#495057}
    .alert{border-radius:12px}
    .brand-badge{
      display:inline-flex;align-items:center;gap:8px;justify-content:center;
      background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);
      padding:6px 10px;border-radius:999px;margin-top:10px;font-size:13px
    }
    .brand-badge i{opacity:.9}
    @media (max-width:480px){
      .card{margin:12px}
      .title{font-size:24px}
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <h1 class="title">Laptop Shop</h1>
      <div class="subtitle">Đăng nhập</div>
      
    </div>

    <div class="card-body">
      <div class="lottie-wrap">
        <lottie-player
          src="https://assets9.lottiefiles.com/packages/lf20_jtbfg2nb.json"
          background="transparent" speed="1"
          style="width:120px;height:120px" loop autoplay>
        </lottie-player>
      </div>

      <div th:if="${param.error}" class="alert alert-warning mb-3">
        <i class="fa-solid fa-triangle-exclamation me-1"></i> Sai tên đăng nhập hoặc mật khẩu.
      </div>
      <div th:if="${param.logout}" class="alert alert-success mb-3">
        <i class="fa-solid fa-circle-check me-1"></i> Đã đăng xuất.
      </div>

      <form th:action="@{/login}" method="post" id="loginForm" novalidate>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="mb-3">
          <label for="username" class="form-label">Tên đăng nhập</label>
          <input id="username" name="username" class="form-control" required autofocus
                 inputmode="email" autocomplete="username"
                 placeholder="vd: user@example.com">
        </div>

        <div class="mb-2 position-relative">
          <label for="password" class="form-label">Mật khẩu</label>
          <input id="password" type="password" name="password" class="form-control"
                 required autocomplete="current-password" placeholder="••••••••">
          <button type="button" class="toggle" id="togglePassword" aria-label="Hiện/Ẩn mật khẩu">
            <i class="fa-solid fa-eye"></i>
          </button>
        </div>

        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="rememberMe" name="remember-me">
            <label class="form-check-label" for="rememberMe">Nhớ đăng nhập</label>
          </div>
          <a class="small" th:href="@{/forgot-password}">Quên mật khẩu?</a>
        </div>

        <button id="submitBtn" type="submit" class="btn btn-primary w-100">
          <span class="btn-text">Đăng nhập</span>
          <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
        </button>

        <div class="mt-2">
          <a href="/oauth2/authorization/google" class="btn btn-outline-danger btn-google">
            <i class="fab fa-google me-2"></i>Đăng nhập với Google
          </a>
        </div>
      </form>

      <hr class="my-4"/>
      <p class="text-center helper mb-0">
        Chưa có tài khoản? <a th:href="@{/register}">Đăng ký</a>
      </p>
    </div>
  </div>

  <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
  <script>
    // Toggle password
    const toggle = document.getElementById('togglePassword');
    const pwd = document.getElementById('password');
    toggle.addEventListener('click', () => {
      const isHidden = pwd.type === 'password';
      pwd.type = isHidden ? 'text' : 'password';
      const icon = toggle.querySelector('i');
      icon.classList.toggle('fa-eye', !isHidden);
      icon.classList.toggle('fa-eye-slash', isHidden);
      toggle.setAttribute('aria-pressed', isHidden ? 'true' : 'false');
      pwd.focus();
    });

    // Chống submit nhiều lần + spinner
    const form = document.getElementById('loginForm');
    const submitBtn = document.getElementById('submitBtn');
    form.addEventListener('submit', () => {
      submitBtn.disabled = true;
      submitBtn.querySelector('.spinner-border').classList.remove('d-none');
    });

    // Enter ở input sẽ focus hợp lý
    document.getElementById('username').addEventListener('keydown', e=>{
      if(e.key==='Enter'){ e.preventDefault(); document.getElementById('password').focus(); }
    });
  </script>
</body>
</html>
